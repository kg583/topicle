<html lang="en-us">
<head>
<meta charset="UTF-8" />
<title>Topicle</title>
<meta name="description" content="Put your skills to the test and solve four themed Wordles at once! You have 7 guesses to match all four words to the clue. A new Topicle available each day to solve.">
<meta name="keywords" content="Topicle, Quordle, Wordle, word game, clue, puzzle, brain teaser, guess, match">
<meta name="author" content="Kevin Gomez & Walter Price">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

<!-- FB Meta Tags -->
<meta property="og:url" content="https://kg583.github.io/topicle">
<meta property="og:type" content="website">
<meta property="og:title" content="Topicle">
<meta property="og:description" content="Put your skills to the test and solve four themed Wordles at once! You have 7 guesses to match all four words to the clue. A new Topicle available each day to solve.">
<meta property="og:image" content="https://kg583.github.io/topicle/banner.png">
<meta property="og:image:width" content="802">
<meta property="og:image:height" content="531">

<!-- Twitter Meta Tags -->
<meta name="twitter:card" content="summary_large_image">
<meta property="twitter:domain" content="kg583.github.io/topicle">

<meta name="theme-color" content="#181a1b" />
<meta name=color-scheme content="dark">
<link rel="manifest" href="manifest.json" />
<link rel="shortcut icon" sizes="192x192" href="favicon-192.png">
<link rel="shortcut icon" sizes="128x128" href="favicon-128.png">
<link rel="apple-touch-icon" sizes="128x128" href="favicon-128.png">
<link rel="apple-touch-icon-precomposed" sizes="128x128" href="favicon-128.png">
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@500&display=swap" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://googletagmanager.com/gtag/js?id=G-X7RXK3GNJ9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-X7RXK3GNJ9');
</script>
<style>
html {
  background-color: rgb(24, 26, 27);
}

body {
    font-family: 'Outfit', sans-serif;
    background-color: rgb(24, 26, 27);
    color: white;
    margin: 0;
}

a {
    color: white;
}

:root {
    --boxsize: 50px;
    --spacing: 0px;
    --collapse: separate;
}

.body-ios {
    height: -moz-calc(100% - 25px) !important;
    height: -webkit-calc(100% - 25px) !important;
    height: calc(100% - 25px) !important;
    bottom: 25px;
}

.button {
    width: var(--boxsize);
    height: var(--boxsize);
}

.box {
    border: white 1px solid;

    padding: 0px;
    text-align: center;
    background-color: rgb(24, 26, 27);
    overflow: hidden;
    border-spacing: var(--spacing);
    color: white;

    user-select: none;

    -webkit-user-select: none;
    /* Safari */
    -moz-user-select: none;
    /* Firefox */
    -ms-user-select: none;
    /* Standard */
}

.key {
    cursor: pointer;
    touch-action: manipulation;
}

.bg-quad {
    color: black;
    background-size: 50% 50%;
    background-position: 0% 0%, 0% 100%, 100% 0%, 100% 100%;
    background-repeat: no-repeat;
}

.bg11 {
    background-image: linear-gradient(45deg, #919191, #919191 100%), linear-gradient(135deg, #ffcc00, #ffcc00), linear-gradient(225deg, #00cc88, #00cc88), linear-gradient(225deg, #ffcc00, #ffcc00);
}

.bg22 {
    background-image: linear-gradient(45deg, #919191, #919191 100%), linear-gradient(135deg, #919191, #919191), linear-gradient(225deg, #00cc88, #00cc88), linear-gradient(225deg, #00cc88, #00cc88);
}

.bg33 {
    background-image: linear-gradient(45deg, #00cc88, #00cc88 100%), linear-gradient(135deg, #919191, #919191), linear-gradient(225deg, #ffcc00, #ffcc00), linear-gradient(225deg, #00cc88, #00cc88);
}

.bg44 {
    background-image: linear-gradient(45deg, #919191, #919191 100%), linear-gradient(135deg, #ffcc00, #ffcc00), linear-gradient(225deg, #ffcc00, #ffcc00), linear-gradient(225deg, #919191, #919191);
}

.bg55 {
    background-image: linear-gradient(45deg, #919191, #919191 100%), linear-gradient(135deg, #00cc88, #00cc88), linear-gradient(225deg, #919191, #919191), linear-gradient(225deg, #919191, #919191);
}

.bg66 {
    background-image: linear-gradient(45deg, #919191, #919191 100%), linear-gradient(135deg, #919191, #919191), linear-gradient(225deg, #919191, #919191), linear-gradient(225deg, #ffcc00, #ffcc00);
}

.bg1 {
    background-image: linear-gradient(to right, rgb(24, 26, 27), rgb(24, 26, 27) 50%, #00cc88 50%, #00cc88);
}

.bg2 {
    background-image: linear-gradient(to right, rgb(24, 26, 27), rgb(24, 26, 27) 50%, #ffcc00 50%, #ffcc00);
}

.bg3 {
    background-image: linear-gradient(to right, #ffcc00, #ffcc00 50%, #00cc88 50%, #00cc88);
}

.bg4 {
    background-image: linear-gradient(to right, #00cc88, #00cc88 50%, #ffcc00 50%, #ffcc00);
}

.bg5 {
    background-image: linear-gradient(to right, #ffcc00, #ffcc00 50%, rgb(24, 26, 27) 50%, rgb(24, 26, 27));
}

.bg6 {
    background-image: linear-gradient(to right, #00cc88, #00cc88 50%, rgb(24, 26, 27) 50%, rgb(24, 26, 27));
}

table {
    font-size: inherit;
}

.table_guesses {
    border-collapse: var(--collapse);
    border-spacing: var(--spacing);
}
</style>
</head>
<body>
<div id="body" style="max-width:550px;margin:auto;height:100%;display:flex">
    <div id="title" width="100%" style="margin:auto;flex:1;">
        <center>
            <div class="button">&nbsp;</div>
            <div style="width: 67%;">
                <table style="width:100%;">
                    <tr>
                        <td class="box button bg-quad bg11" style="width:12.8%">T</td>
                        <td class="box button bg-quad bg66" style="width:12.8%">O</td>
                        <td class="box button bg-quad bg55" style="width:12.8%">P</td>
                        <td class="box button bg-quad bg33" style="width:12.8%">I</td>
                        <td class="box button bg-quad bg22" style="width:12.8%">C</td>
                        <td class="box button bg-quad bg55" style="width:12.8%">L</td>
                        <td class="box button bg-quad bg44" style="width:12.8%">E</td>
                    </tr>
                </table>
            </div>
            <div style="font-size:80%;">
                <table style="width:100%;">
                    <tr>
                        <td style="width:50%; text-align:right;">&copy;2022 Kevin</td>
                        <td style="width:50%;">Gomez</td>
                    </tr>
                    <tr>
                        <td style="width:50%; text-align:right;">& </td>
                        <td style="width:50%;">Walter Price</td>
                    </tr>
                </table>
            </div>
            <div style="font-size:50%;">
                <table style="width:100%;">
                    <tr>
                        <td style="width:50%; text-align:right;">based on <a href="https://octordle.com" target="_blank">Octordle</a></td>
                        <td style="width:50%;">by Kenneth Crawford</td>
                    </tr>
                </table>
            </div>
            <div style="font-size:50%;">
                <table style="width:100%;">
                    <tr>
                        <td style="width:50%; text-align:right;">based on <a href="https://quordle.com" target="_blank">Quordle</a></td>
                        <td style="width:50%;">by @fireph</td>
                    </tr>
                </table>
            </div>
            <div style="font-size:50%;">
                <table style="width:100%;">
                    <tr>
                        <td style="width:50%; text-align:right;">based on <a href="https://zaratustra.itch.io/dordle" target="_blank">Dordle</a></td>
                        <td style="width:50%;">by Guilherme S. T&ouml;ws</td>
                    </tr>
                </table>
            </div>
            <div id="tutorial1" style="padding:12px;cursor:pointer;">
                <img src="help_outline.svg" width="32" height="32" alt="">
            </div>
            <div class="box bg1" style="width: 60%; border:double;cursor:pointer;" id="daily">
                <table style="width:100%;">
                    <tr>
                        <td style="width:50%; text-align:right;">daily</td>
                        <td style="width:50%; color:black;">topicle</td>
                    </tr>
                </table>
            </div>
            <div style="height:8px;">&nbsp;</div>
            <div class="bg3" style="font-size:80%;">
                <table style="width:100%; color:black;">
                    <tr>
                        <td style="width:50%; text-align:right;">a new Topicle</td>
                        <td style="width:50%;">each day</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td id="next_daily">every day</td>
                    </tr>
                </table>
            </div>
            <div class="button"></div>
            <div class="box bg2" style="width: 60%; border:double;cursor:pointer;" id="beta">
                <table style="width:100%;">
                    <tr>
                        <td style="width:50%; text-align:right;">beta</td>
                        <td style="width:50%; color:black;">puzzles</td>
                    </tr>
                </table>
            </div>
            <div style="height:8px;">&nbsp;</div>
            <div class="bg4" style="font-size:80%;">
                <table style="width:100%; color:black;">
                    <tr>
                        <td style="width:50%; text-align:right;">test out</td>
                        <td style="width:50%;">our puzzles</td>
                    </tr>
                    <tr>
                        <td style="width:50%; text-align:right;"></td>
                        <td style="width:50%">(spoilers)</td>
                    </tr>
                </table>
            </div>
            <div style="height:32px;">&nbsp;</div>
            <div class="box" style="width: 60%; border:double;cursor:pointer;" id="widescreen-reset">
                Reset Widescreen Mode
            </div>
        </center>
    </div>
    <div id="tutorial" style="width:100%;height:100%;overflow:auto;padding-left:8px;padding-right:8px;font-size:50%;display:none;color:white;background-color:rgb(24, 26, 27);">
        <table style="width: 100%;font-size:200%;">
            <tr>
                <td class="box" style="width:35%;cursor:pointer;" id="leave_tutorial">back</td>
            </tr>
        </table>
        <h3>Guess all four TOPICLE words in 7 tries.</h3>
        <p>Each guess must be a valid 5 letter word. Hit the enter button to submit.<br><br>After each guess, the color of the tiles will change to show how close your guess was to the word.</p>
        <h2>Examples</h2>
        <table style="width: 50%; border-spacing:0px;font-size:200%;">
            <tr>
                <td style="width: 50%; padding:0px;">
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%"  style="background-color:#00cc88;color:black;">C</td>
                            <td class="box button" width="20%" >R</td>
                            <td class="box button" width="20%" >O</td>
                            <td class="box button" width="20%" >W</td>
                            <td class="box button" width="20%" >N</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <p>The letter C is in the word and in the correct spot.<br><br></p>
        <table style="width: 50%; border-spacing:0px;font-size:200%;">
            <tr>
                <td style="width: 50%; padding:0px;">
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%" >B</td>
                            <td class="box button" width="20%"  style="background-color:#ffcc00;color:black;">A</td>
                            <td class="box button" width="20%" >D</td>
                            <td class="box button" width="20%" >G</td>
                            <td class="box button" width="20%" >E</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <p>The letter A is in the word but in the wrong spot.<br><br></p>
        <table style="width: 50%; border-spacing:0px;font-size:200%;">
            <tr>
                <td style="width: 50%; padding:0px;">
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%" >C</td>
                            <td class="box button" width="20%" >O</td>
                            <td class="box button" width="20%" >M</td>
                            <td class="box button" width="20%" >F</td>
                            <td class="box button" width="20%" >Y</td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <p>The letters C, O, M, F, Y are not in the word in any spot.<br><br>When you type a guess in TOPICLE, you will guess that word for all four words that you are solving. Each word will be different, and may be a proper noun or name.<br><br>All four words will be somehow related to the clue at the top of the page. Clue topics will vary from science to history to pop culture and more!<br></p>
        <div style="text-align: center; font-size: 250%">MATERIALS</div><br>
        <table style="width: 100%; border-spacing:0px;font-size:200%;">
            <tr>
                <td style="width: 50%; padding:0px;">
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%">S</td>
                            <td class="box button" width="20%">T</td>
                            <td class="box button" width="20%">E</td>
                            <td class="box button" width="20%">E</td>
                            <td class="box button" width="20%">L</td>
                        </tr>
                    </table>
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                        </tr>
                    </table>
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                        </tr>
                    </table>
                </td>
                <td style="width: 50%; padding:0px;">
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%" >S</td>
                            <td class="box button" width="20%">T</td>
                            <td class="box button" width="20%" style="background-color:#ffcc00;color:black;">E</td>
                            <td class="box button" width="20%">E</td>
                            <td class="box button" width="20%" style="background-color:#00cc88;color:black;">L</td>
                        </tr>
                    </table>
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                        </tr>
                    </table>
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td style="width: 50%; padding:0px;">
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%">S</td>
                            <td class="box button" width="20%" style="background-color:#ffcc00;color:black;">T</td>
                            <td class="box button" width="20%">E</td>
                            <td class="box button" width="20%">E</td>
                            <td class="box button" width="20%">L</td>
                        </tr>
                    </table>
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                        </tr>
                    </table>
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                        </tr>
                    </table>
                </td>
                <td style="width: 50%; padding:0px;">
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%">S</td>
                            <td class="box button" width="20%">T</td>
                            <td class="box button" width="20%" style="background-color:#00cc88;color:black;">E</td>
                            <td class="box button" width="20%" style="background-color:#ffcc00;color:black;">E</td>
                            <td class="box button" width="20%">L</td>
                        </tr>
                    </table>
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                        </tr>
                    </table>
                    <table style="width: 100%;" class="table_guesses">
                        <tr>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                            <td class="box button" width="20%"></td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>
        <p>For the guess STEEL:
            <ol>
                <li>The top left word has none of the letters.</li>
                <li>The top right word has one E in the wrong spot and the L in the correct spot.</li>
                <li>The bottom left word has the T in the wrong spot.</li>
                <li>The bottom right word has the first E in the right spot and a second E in the wrong spot.</li>
            </ol>
        <p>You have 7 guesses to get all 4 words correct. Good luck!</p>
        <p>A new Topicle will be available each day!<br><br></p>
    </div>
    <div id="game" style="display: none;flex-direction: column;" width="100%">
        <table style="width: 100%;">
            <tr>
                <td class="box" style="width:25%;cursor:pointer;" id="restart">back</td>
                <td class="box" style="width:20%;cursor:pointer;display:none;" id="reset_beta">new</td>
                <td style="width:*; text-align:center;font-size:75%;" id="game_title"></td>
                <td id="tutorial2" style="padding:6px;cursor:pointer;width:32px;">
                    <img src="help_outline.svg" width="32" height="32" alt="">
                </td>
                <td id="fullscreen" style="padding:6px;cursor:pointer;width:32px;display:none;">
                    <img src="fullscreen.svg" width="32" height="32" alt="">
                </td>
                <td id="exit_fullscreen" style="padding:6px;cursor:pointer;width:32px;display:none;">
                    <img src="fullscreen_exit.svg" width="32" height="32" alt="">
                </td>
            </tr>
        </table>
        <table id="widescreen-question" style="width: 100%; font-size: 75%">
            <td style="width:*">
                Want to try widescreen mode?
            </td>
            <td class="box" id="widescreen-yes">
                Yes
            </td>
            <td class="box" id="widescreen-no">
                No
            </td>
        </table>
        <div style="text-align: center;" id="clue"></div>
        <div id="normal-container" style="width: 100%; flex: 1;overflow: auto;">
            <table style="width: 100%; border-spacing:0px;">
                <tr>
                    <td style="width: 50%; padding:0px;" id="box-holder-1">
                    </td>

                    <td style="width: 50%; padding:0px;" id="box-holder-2">
                    </td>
                </tr>


                <tr>
                    <td style="width: 50%; padding:0px;" id="box-holder-3">
                    </td>

                    <td style="width: 50%; padding:0px;" id="box-holder-4">
                    </td>
                </tr>
            </table>
        </div>
        <div id="widescreen-container" style="width:100%; flex: 1; overflow: auto; display:none; min-height: 500px;">
            <div style="display: flex; justify-content: space-between; gap: 15px; min-height: 550px">
                <div id="box-holder-1-widescreen"></div>
                <div id="box-holder-2-widescreen"></div>
                <div id="box-holder-3-widescreen"></div>
                <div id="box-holder-4-widescreen"></div>
            </div>
        </div>
        <div id="post_game">
            <table width="100%">
                <tr height="12%">
                    <td rowspan=5 style="width:50%;">
                        <label for="share_content"></label><textarea class="box" style="width:100%; border: 1px solid;overflow:auto;resize:none;" rows=20 id="share_content">test</textarea>
                    </td>
                    <td style="font-size:75%; width:50%; text-align:center; vertical-align: top; padding-top: 15px;">
                        <div style="font-size:100%; width:50%; text-align:center; white-space: pre;" id="answer12">&nbsp;</div>
                        <div style="font-size:100%; width:50%; text-align:center; white-space: pre;" id="answer34">&nbsp;</div>

                    </td>
                </tr>
                <tr height="14.2%">
                </tr>
                <tr height="14.2%">
                    <td class="box" style="font-size:50%;width:50%;cursor:pointer;visibility:hidden;padding:8px;" id="share">
                        share
                    </td>
                </tr>
                <tr height="14.2%">
                    <td class="box" style="border: none; border-style: double;font-size:50%;width:50%;cursor:pointer;visibility:hidden;padding:8px;" id="share_image">
                        share as image (twitter)
                    </td>
                </tr>
                <tr height="14.2%">
                    <td class="box" style="font-size:50%;width:50%;cursor:pointer;padding:8px;" id="share_clipboard">
                        copy to clipboard
                    </td>
                </tr>
                <tr height="14.2%"></tr>
                <!-- <tr height="20%">
                    <td class="box" style="border: none; border-style: double;font-size:50%;height:33%;align-items:middle;" >
                        <a id="tweet_link" href="https://twitter.com/share" target="_blank" style="display:block;width:100%;height:100%;text-decoration:none;">
                        tweet
                        </a>
                    </td>
                </tr> -->
            </table>
        </div>
        <table id="keyboard" style="width: 100%; max-width: 550px; margin: auto" class="table_guesses">
            <tr>
                <td class="box button key" width="10%" id="q">Q</td>
                <td class="box button key" width="10%" id="w">W</td>
                <td class="box button key" width="10%" id="e">E</td>
                <td class="box button key" width="10%" id="r">R</td>
                <td class="box button key" width="10%" id="t">T</td>
                <td class="box button key" width="10%" id="y">Y</td>
                <td class="box button key" width="10%" id="u">U</td>
                <td class="box button key" width="10%" id="i">I</td>
                <td class="box button key" width="10%" id="o">O</td>
                <td class="box button key" width="10%" id="p">P</td>
            </tr>
            <tr>
                <td class="box button key" width="10%" id="a">A</td>
                <td class="box button key" width="10%" id="s">S</td>
                <td class="box button key" width="10%" id="d">D</td>
                <td class="box button key" width="10%" id="f">F</td>
                <td class="box button key" width="10%" id="g">G</td>
                <td class="box button key" width="10%" id="h">H</td>
                <td class="box button key" width="10%" id="j">J</td>
                <td class="box button key" width="10%" id="k">K</td>
                <td class="box button key" width="10%" id="l">L</td>
                <td class="box button key" style="border-bottom:none;" width="10%" id="enter3"></td>
            </tr>
            <tr>
                <td class="box button key" width="10%" id="bs">&#x232B;</td>
                <td class="box button key" width="10%" id="z">Z</td>
                <td class="box button key" width="10%" id="x">X</td>
                <td class="box button key" width="10%" id="c">C</td>
                <td class="box button key" width="10%" id="v">V</td>
                <td class="box button key" width="10%" id="b">B</td>
                <td class="box button key" width="10%" id="n">N</td>
                <td class="box button key" width="10%" id="m">M</td>
                <td class="box button key" style="border-right: none;" width="10%" id="enter1"></td>
                <td class="box button key" style="border-left: none; border-top:none;" width="10%" id="enter2">&#x23CE;</td>
            </tr>
        </table>
        <div id="box button" style="visibility: hidden">Test</div>
    </div>
</div>

<canvas id="canvas" width="176" height="352" style="position:absolute;left:0;top:0;display:none;"></canvas>
<script src="https://v6p9d9t4.ssl.hwcdn.net/html/5162977/mersenne.js"></script>
<script src="answers.js"></script>
<script src="allowed.js"></script>
<script>

function makeBox(boxId, suffix) {
    const template = `<table style="width: 100%;" class="table_guesses">
        <tr>
            <td class="box button" width="20%" id="box${boxId},1,1,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},1,2,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},1,3,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},1,4,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},1,5,${suffix}"></td>
        </tr>
        <tr>
            <td class="box button" width="20%" id="box${boxId},2,1,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},2,2,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},2,3,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},2,4,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},2,5,${suffix}"></td>
        </tr>
        <tr>
            <td class="box button" width="20%" id="box${boxId},3,1,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},3,2,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},3,3,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},3,4,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},3,5,${suffix}"></td>
        </tr>
        <tr>
            <td class="box button" width="20%" id="box${boxId},4,1,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},4,2,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},4,3,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},4,4,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},4,5,${suffix}"></td>
        </tr>
        <tr>
            <td class="box button" width="20%" id="box${boxId},5,1,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},5,2,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},5,3,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},5,4,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},5,5,${suffix}"></td>
        </tr>
        <tr>
            <td class="box button" width="20%" id="box${boxId},6,1,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},6,2,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},6,3,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},6,4,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},6,5,${suffix}"></td>
        </tr>
        <tr>
            <td class="box button" width="20%" id="box${boxId},7,1,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},7,2,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},7,3,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},7,4,${suffix}"></td>
            <td class="box button" width="20%" id="box${boxId},7,5,${suffix}"></td>
        </tr>
    </table>`

    const container = document.createElement("div");
    container.innerHTML = template;
    return container.firstChild;
}

function setupBoxes() {
    for(let box = 0; box < TOTAL_BOXES; box++) {
        acquire(`box-holder-${box + 1}`).appendChild(makeBox(box + 1, ""));
        acquire(`box-holder-${box + 1}-widescreen`).appendChild(makeBox(box + 1, "widescreen"));
    }
}



const TOTAL_LINES = 7;
const TOTAL_COLUMNS = 5;
const TOTAL_BOXES = 4;

function forEachCell(callback) {
    for(let line = 0; line < TOTAL_LINES; line++) {
        for(let column = 0; column < TOTAL_COLUMNS; column++) {
            for(let box = 0; box < TOTAL_BOXES; box++) {
                boxOperation(box, line, column, boxEl => {
                    callback(box, line, column, boxEl);
                });
            }
        }
    }
}

function forEachCellForLine(line, callback) {
    for(let column = 0; column < TOTAL_COLUMNS; column++) {
        for(let box = 0; box < TOTAL_BOXES; box++) {
            boxOperation(box, line, column, boxEl => {
                callback(box, column, boxEl);
            });
        }
    }
}

function forEachCellForLineColumn(line, column, callback) {
    for(let box = 0; box < TOTAL_BOXES; box++) {
        boxOperation(box, line, column, boxEl => {
            callback(box, boxEl);
        });
    }
}


function el(n, t) {
    let e = document.createElement(n);
    if (t) e.appendChild(t);
    return e;
}

function newElement(_elementType, _parent, _className) {
    let e = document.createElement(_elementType);
    if (_className) e.className = _className;
    if (_parent) {
        _parent.appendChild(e);
        e.parent = _parent;
    }
    return e;
}

function text(t) {
    return document.createTextNode(t);
}

function clear(out) {
    out.innerHTML = "";
}

function ppint(out, t) {
    out.appendChild(text(t));
}

function printclear(out, t) {
    if (out == null) return;
    clear(out);
    ppint(out, t);
}

function ln(out) {
    out.appendChild(document.createElement("br"));
}

function printcolor(out, t, color, bgcolor, s) {
    let tx = document.createElement("span");
    tx.innerHTML = t;
    tx.style.color = s ? bgcolor : color;
    tx.style.backgroundColor = s ? color : bgcolor;
    out.appendChild(tx);
}

function printclass(out, t, c) {
    tx = document.createElement("span");
    tx.innerHTML = t;
    console.log(c);
    tx.className = c;
    console.log(tx);
    out.appendChild(tx);
}

function append(out, t) {
    out.appendChild(t);
}

function acquire(out) {
    return document.getElementById(out);
}

function acquireBox(box, line, column, mode, callback) {
    mode = mode || "";
    let el = acquire(`box${box + 1},${line + 1},${column + 1},${mode}`);

    if(!el) {
        debugger;
    }

    if(el && callback) {
        callback(el);
    }

    return el;
}

function boxOperation(box, line, column, callback) {
    acquireBox(box, line, column, null, callback);
    acquireBox(box, line, column, "widescreen", callback);
}

function random(n) {
    return (Math.random() * n) >> 0;
}

function randomArray(arr) {
    return arr[(Math.random() * arr.length) >> 0];
}

function randomDate(start, end) {
    return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
}

function int(n) {
    return n >> 0;
}

function trace(s) {
    console.log(s);
}

function registerLoop(e, f) {
    e.loop = f;
    e.interval = setInterval(function() {
        e.loop();
    }, 1000 / framerate);
}

function destroy(e, p) {
    if (e.destroyed) return;
    if (e.interval) clearInterval(e.interval);
}

function output(obj1) {
    append(acquire("out"), el("p", text(obj1)));
}

function remove(arr, term) {
    if (arr.indexOf(term) !== -1) arr.splice(arr.indexOf(term), 1);
}

daily_mode = false;
beta_mode = false;
tutorial_mode = false;
restoring_game = false;

function pushHistory(paramsToSet) {
    let searchParams = new URLSearchParams(location.search);
    let paramsStringBefore = searchParams.toString();
    for (let key of Object.keys(paramsToSet)) {
        if (paramsToSet[key] === undefined || paramsToSet[key] === null) {
            searchParams.delete(key);
        } else {
            searchParams.set(key, paramsToSet[key]);
        }
    }
    let paramsString = searchParams.toString();
    if (paramsString !== paramsStringBefore) {
        if (paramsString) {
            window.history.pushState({}, "", location.pathname + "?" + paramsString);
        } else {
            window.history.pushState({}, "", location.pathname);
        }
        onStateChange();
    }
}

function vibrate() {
    if (navigator.vibrate) {
        navigator.vibrate(1)
    }
}

function iOS() {
  return [
    'ipad simulator',
    'iphone simulator',
    'ipod simulator',
    'ipad',
    'iphone',
    'ipod'
  ].includes(navigator.platform.toLowerCase())
  // iPad on iOS 13 detection
  || (navigator.userAgent.toLowerCase().includes("mac") && "ontouchend" in document)
}

isInWebAppiOS = (window.navigator.standalone === true);
isInWebViewiOS = /(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent);
isInWebAppChrome = (window.matchMedia('(display-mode: standalone)').matches);

if (iOS() && isInWebAppiOS) {
    acquire("body").classList.add("body-ios");
}

function canGoFullscreen() {
    return !iOS() && !isInWebAppiOS && !isInWebAppChrome && (document.body.requestFullscreen || document.body.mozRequestFullScreen || document.body.webkitRequestFullScreen || document.body.msRequestFullscreen);
}

function isInFullscreen() {
    return document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;
}

function initDaily() {
    daily_mode = true;
    beta_mode = false;
    restart();
    acquire("title").style.display = "none";
    acquire("game").style.display = "flex";
    acquire("tutorial").style.display = "none";
    acquire("reset_beta").style.display= "none";
    if (canGoFullscreen()) {
        acquire("fullscreen").style.display = "";
        acquire("exit_fullscreen").style.display = "none";
    } else {
        acquire("fullscreen").style.display = "none";
        acquire("exit_fullscreen").style.display = "none";
    }
    if (window.gtag) {
        gtag("event", "start", {
            mode: "daily",
            daily_key: daily_mode ? key : undefined
        });
    }
}

function initBeta() {
    daily_mode = false;
    beta_mode = true;
    restart();
    acquire("title").style.display = "none";
    acquire("game").style.display = "flex";
    acquire("tutorial").style.display = "none";
    acquire("reset_beta").style.display= "";
    if (canGoFullscreen()) {
        acquire("fullscreen").style.display = "";
        acquire("exit_fullscreen").style.display = "none";
    } else {
        acquire("fullscreen").style.display = "none";
        acquire("exit_fullscreen").style.display = "none";
    }
    if (window.gtag) {
        gtag("event", "start", {
            mode: "beta",
            daily_key: undefined
        });
    }
}

function onStateChange() {
    let params = new URLSearchParams(location.search);
    let mode = params.get("mode");
    let tutorial = params.get("tutorial");
    if (tutorial === "true") {
        initTutorial();
    } else if (mode === "daily") {
        initDaily();
    } else if (mode === "beta") {
        initBeta();
    } else {
        initTitle();
    }
}

window.addEventListener("popstate", onStateChange);

function initTutorial() {
    tutorial_mode = true;
    acquire("title").style.display = "none";
    acquire("game").style.display = "none";
    acquire("tutorial").style.display = "";
    if (window.gtag) {
        gtag("event", "tutorial");
    }
}

function initTitle() {
    var mode_leaving = daily_mode ? "daily" : "beta";
    var key_leaving = daily_mode ? key : undefined;
    daily_mode = false;
    beta_mode = false;
    acquire("title").style.display = "";
    acquire("game").style.display = "none";
    acquire("tutorial").style.display = "none";
    acquire("body").style.backgroundColor = "rgb(24, 26, 27)";
    exitFullscreen();
    if (window.gtag) {
        gtag("event", "back", {
            mode: mode_leaving,
            daily_key: key_leaving
        });
    }

    window.onresize();
}

function initFullscreen() {
    if (document.body.requestFullscreen) {
        document.body.requestFullscreen({ navigationUI: "hide" });
    } else if (document.body.mozRequestFullScreen) {
        document.body.mozRequestFullScreen();
    } else if (document.body.webkitRequestFullScreen) {
        document.body.webkitRequestFullScreen();
    } else if (document.body.msRequestFullscreen) {
        document.body.msRequestFullscreen();
    }
}

function exitFullscreen() {
    if (isInFullscreen()) {
        if (document.exitFullscreen) {
            document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
            document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
    }
}

function pressKey(e) {
    pk_wrap(e.key.toLowerCase(), e.keyCode);
}

function pk(k, keyCode) {
    k = k.toUpperCase();
    if (!daily_mode && !beta_mode) return;
    if (line >= TOTAL_LINES) return;
    if (keyCode === 8) {
        if (column <= 0) return;
        guess_current = guess_current.slice(0, guess_current.length - 1);
        column--;


        forEachCellForLineColumn(line, column, (box, el) => {
            if(answer_correct[box] < 0) {
                clear(el);
            }
        });

        test_real_word(line, guess_current);
        return;
    }
    if (keyCode === 13) {
        if (allowed.indexOf(guess_current) === -1) {
            guess_current = "";
            clear_line(line);
            test_real_word(line, guess_current);
            column = 0;
            return;
        }
        if (column >= TOTAL_COLUMNS) {
            if (!restoring_game && window.gtag) {
                gtag("event", "guess", {
                    mode: daily_mode ? "daily" : "beta",
                    daily_key: daily_mode ? key : undefined,
                    word: guess_current
                });
            }
            guesses.push(guess_current);

            forEachCellForLineColumn(line, column - 1, (box, el) => {
                if (answer_correct[box] < 0) {
                    identify_guess(box, line, guess_current);
                }

                if (answer[box] === guess_current) {
                    answer_correct[box] = line;
                }
            });

            line++;
            column = 0;
            guess_current = "";

            if (answer_correct[0] >= 0 && answer_correct[1] >= 0 && answer_correct[2] >= 0 && answer_correct[3] >= 0) {
                acquire("body").style.backgroundColor = "green";
                acquire("body").style.color = "black";
                show_post_game(true);
                if (!restoring_game && window.gtag) {
                    gtag("event", "win", {
                        mode: daily_mode ? "daily" : "beta",
                        daily_key: daily_mode ? key : undefined,
                        guesses: guesses
                    });
                }
            } else if (line >= TOTAL_LINES) {
                acquire("body").style.backgroundColor = "red";
                acquire("body").style.color = "black";
                show_post_game(true);
                if (!restoring_game && window.gtag) {
                    var totalCorrect = 0;
                    for (var i = 0; i < answer_correct.length; i++) {
                        if (answer_correct[i] >= 0) {
                            totalCorrect++;
                        }
                    }
                    gtag("event", "loss", {
                        mode: daily_mode ? "daily" : "beta",
                        daily_key: daily_mode ? key : undefined,
                        guesses: guesses,
                        total_correct: totalCorrect
                    });
                }
            }

            render_bg_keys();

        }
        return;
    }
    if ("ABCDEFGHIJKLMNOPQRSTUVWXYZ".indexOf(k) === -1) return;
    if (column >= TOTAL_COLUMNS) return;
    forEachCellForLineColumn(line, column, (box, el) => {
        if (answer_correct[box] < 0) {
            ppint(el, k);
        }
    });

    guess_current += k;
    column++;
    if (column >= TOTAL_COLUMNS) {
        test_real_word(line, guess_current);
    }
}

function pk_wrap(k, keyCode) {
    pk(k, keyCode);
    if ((daily_mode || beta_mode) && keyCode === 13) {
        update_local_storage();
    }
}

function show_post_game(show) {
    if (show) {
        acquire("post_game").style.display = "";
        acquire("keyboard").style.display = "none";
        acquire("share").style.visibility = navigator.share ? "" : "hidden";
        acquire("share_image").style.visibility = navigator.share ? "" : "hidden";
        do_share(false, "clipboard");
    } else {
        acquire("post_game").style.display = "none";
        acquire("keyboard").style.display = "";
    }
}

function test_real_word(line, guess_current) {
    var real = !(allowed.indexOf(guess_current) === -1)
    if (guess_current.length < TOTAL_COLUMNS) real = true;
    forEachCellForLine(line, (box, column, el) => {
        if (answer_correct[box] < 0) {
            el.style.color = real ? "white" : "red";
        }
    });
}

last_daily = null;
no_localstorage = false;

try {
    last_daily = window.localStorage.getItem("last_daily");
} catch (e) {
    no_localstorage = true;
}

function time_to_next() {
    try {
        if (last_daily == null) last_daily = window.localStorage.getItem("last_daily");
    } catch (e) {
        no_localstorage = true;
    }
    if (last_daily == null) return null;

    let date = new Date();
    let timeLeftSeconds = (Date.parse(last_daily) - date.getTime()) / 1000;

    let value = 0;
    let name = "";
    if (timeLeftSeconds < 0) return null;
    if (timeLeftSeconds < 60) {
        value = (timeLeftSeconds >> 0);
        name = " second";
    } else if (timeLeftSeconds < 60 * 60) {
        value = ((timeLeftSeconds / 60) >> 0);
        name = " minute";
    } else {
        value = ((timeLeftSeconds / 60 / 60) >> 0);
        name = " hour";
    }
    return value + name + (value > 1 ? "s" : "");
}

function setTimeToNext() {
    if (!no_localstorage) {
        let next_description = time_to_next();
        if (next_description == null) printclear(acquire("next_daily"), "every day");
        else printclear(acquire("next_daily"), "(next in " + next_description + ")");
    }
}

setInterval(setTimeToNext, 1000);
setTimeToNext();

function restart() {
    acquire("body").style.backgroundColor = "rgb(24, 26, 27)";
    acquire("clue").style.color = "white";

    show_post_game(false);

    if (daily_mode) {
        let date = (new Date());
        key = date.toLocaleDateString("en-US", {month: "long", day: "numeric"})

        printclear(acquire("game_title"), "Topicle - " + key);
        last_daily = key;
        if (!no_localstorage) {
            try {
                let prevDaily = window.localStorage.getItem("last_daily");
                window.localStorage.setItem("last_daily", key);
                if (key !== prevDaily) {
                    window.localStorage.setItem("daily_guesses", "");
                }
            } catch (e) {
                no_localstorage = true;
            }
        }
    } else if (beta_mode) {
        if (!no_localstorage) {
            try {
                key = window.localStorage.getItem("last_beta");
            } catch (e) {
                no_localstorage = true;
            }
        }
        if (!key || int(key) != 0) {
            key = randomDate(new Date(2024, 1, 1), new Date(2024, 12, 31)).toLocaleDateString("en-US", {month: "long", day: "numeric"})
            window.localStorage.setItem("last_beta", key);
        }
        printclear(acquire("game_title"), "Beta Topicle");
    }

    entry = answers[key]
    clue = entry[0]
    answer = entry[1]
    printclear(acquire("clue"), clue);

    line = 0;
    column = 0;
    guesses = [];
    guess_letters = [{}, {}, {}, {}];
    answer_correct = [-1, -1, -1, -1];
    share = [[], [], [], []];
    guess_current = "";

    for (let l = 0; l < TOTAL_LINES; l++) {
        clear_line(l);
        share.forEach(share => share.push("\u2B1B\u2B1B\u2B1B\u2B1B\u2B1B"))
    }

    acquire("keyboard").style.display = "";
    render_bg_keys();

    if ((daily_mode || beta_mode) && !no_localstorage) {
        try {
            ls_guesses = window.localStorage.getItem(daily_mode ? "daily_guesses" : "beta_guesses")
            ls_guesses = ls_guesses ? ls_guesses.split(",") : [];
            if (ls_guesses.length > 0) {
                restoring_game = true
                for (var i = 0; i < ls_guesses.length; i++) {
                    for (var j = 0; j < ls_guesses[i].length; j++) {
                        pk(ls_guesses[i][j], ls_guesses[i].charCodeAt(j))
                    }
                    pk("enter", 13)
                }
                restoring_game = false
                if (window.gtag) {
                    gtag("event", "restore", {
                        mode: daily_mode ? "daily" : "beta",
                        daily_key: daily_mode ? key : undefined
                    });
                }
            }
        } catch (e) {
            no_localstorage = true;
        }
    }

    window.onresize();
}


function update_local_storage() {
    if (!no_localstorage && (daily_mode || beta_mode)) {
        try {
            window.localStorage.setItem(daily_mode ? "daily_guesses" : "beta_guesses", guesses.join(","));
        } catch (e) {
            no_localstorage = true;
        }
    }
}


function clear_line(line) {
    forEachCellForLine(line, (box, column, el) => {
        clear(el, "");
        el.style.color = "white";
        el.style.backgroundColor = "rgb(24, 26, 27)";
    });
}

function identify_guess(i, line, guess) {
    let ans = answer[i].split("");
    let gue = guess.split("");
    let icons = [];
    for (column = 0; column < TOTAL_COLUMNS; column++) {
        guess_letters[i][gue[column]] = 0;
        boxOperation(i, line, column, box => {
            box.style.backgroundColor = "rgb(24, 26, 27)";
        });
        icons.push('\u2B1C');
    }
    for (column = 0; column < TOTAL_COLUMNS; column++) {
        if (ans[column] === gue[column]) {
            boxOperation(i, line, column, box => {
                box.style.backgroundColor = "#00cc88";
                box.style.color = "black";
            });
            ans[column] = " ";
            guess_letters[i][gue[column]] = 2;
            gue[column] = " ";
            icons[column] = ("\uD83D\uDFE9");
        }
    }
    for (column = 0; column < TOTAL_COLUMNS; column++) {
        if (ans.indexOf(gue[column]) !== -1 && ans[column] !== gue[column] && gue[column] !== " ") {
            boxOperation(i, line, column, box => {
                box.style.backgroundColor = "#ffcc00";
                box.style.color = "black";
            });
            if (guess_letters[i][gue[column]] !== 2) guess_letters[i][gue[column]] = 1;
            ans[ans.indexOf(gue[column])] = " ";
            icons[column] = ("\uD83D\uDFE8");
        }
    }

    share[i][line] = icons.join("");
}

var keys = "abcdefghijklmnopqrstuvwxyz".split("")
for (k in keys) {
    var acq = acquire(keys[k]);
    acq.key = keys[k];
    acq.onclick = function() {
        vibrate();
        pk_wrap(this.key, 0);
    }
}
acquire("daily").onclick = function() {
    vibrate();
    pushHistory({mode: "daily"})
}
acquire("beta").onclick = function() {
    vibrate();
    pushHistory({mode: "beta"})
}
acquire("tutorial1").onclick = function() {
    vibrate();
    pushHistory({tutorial: "true"})
}
acquire("tutorial2").onclick = function() {
    vibrate();
    pushHistory({tutorial: "true"})
}
acquire("fullscreen").onclick = function() {
    vibrate();
    initFullscreen();
}
acquire("exit_fullscreen").onclick = function() {
    vibrate();
    exitFullscreen();
}

acquire("widescreen-yes").onclick = function() {
    localStorage.setItem('widescreen', "yes");
    if (window.gtag) {
        gtag("event", "widescreen", {
            mode: "yes",
            width: window.innerWidth
        });
        gtag("event", "widescreen-yes", {
            width: window.innerWidth
        });
    }
    window.onresize();
}
acquire("widescreen-no").onclick = function() {
    localStorage.setItem('widescreen', "no");
    if (window.gtag) {
        gtag("event", "widescreen", {
            mode: "no",
            width: window.innerWidth
        });
        gtag("event", "widescreen-no", {
            width: window.innerWidth
        });
    }
    window.onresize();
}

acquire("widescreen-reset").onclick = function() {
    localStorage.removeItem('widescreen');
    if (window.gtag) {
        gtag("event", "widescreen-reset", {
            width: window.innerWidth
        });
    }
    window.onresize();
}

function fullscreenHandler() {
    if (isInFullscreen()) {
        acquire("fullscreen").style.display = "none";
        acquire("exit_fullscreen").style.display = "";
    } else {
        acquire("fullscreen").style.display = "";
        acquire("exit_fullscreen").style.display = "none";
    }
}

if (document.addEventListener) {
    document.addEventListener('fullscreenchange', fullscreenHandler, false);
    document.addEventListener('mozfullscreenchange', fullscreenHandler, false);
    document.addEventListener('MSFullscreenChange', fullscreenHandler, false);
    document.addEventListener('webkitfullscreenchange', fullscreenHandler, false);
}

acquire("enter1").onclick = function() {
    vibrate();
    pk_wrap("", 13);
}
acquire("enter2").onclick = function() {
    vibrate();
    pk_wrap("", 13);
}
acquire("enter3").onclick = function() {
    vibrate();
    pk_wrap("", 13);
}
acquire("bs").onclick = function() {
    vibrate();
    pk_wrap("", 8);
}
acquire("restart").onclick = function() {
    vibrate();
    pushHistory({mode: undefined})
}
acquire("leave_tutorial").onclick = function() {
    vibrate();
    pushHistory({tutorial: undefined})
}
acquire("share").onclick = function() {
    do_share(true, "share");
}
acquire("share_clipboard").onclick = function() {
    do_share(true, "clipboard");
}
acquire("share_image").onclick = function() {
    do_share(true, "image");
}
acquire("reset_beta").onclick = function() {
    vibrate();
    if (isInWebViewiOS || confirm("Are you sure you want to start a new Beta Topicle? (The current game will be deleted)")) {
        window.localStorage.removeItem("beta_guesses");
        window.localStorage.removeItem("last_beta");
        initBeta();
    }
}

const emojiMap = ["1", "2", "3", "4", "5", "6", "7"]

function get_num_emoji(num) {
    if (num < 0) {
        return "\uD83D\uDFE5"
    } else if(num < emojiMap.length) {
        return emojiMap[num];
    }
    return "";
}

function get_next_color_from_emojis(emojis) {
    if (emojis.startsWith("\uD83D\uDFE9")) {
        return ["#00cc88", emojis.replace("\uD83D\uDFE9", "")]; // green
    } else if (emojis.startsWith("\uD83D\uDFE8")) {
        return ["#ffcc00", emojis.replace("\uD83D\uDFE8", "")]; // yellow
    } else if (emojis.startsWith("\u2B1C")) {
        return ["#e0e0e0", emojis.replace("\u2B1C", "")]; // white
    } else if (emojis.startsWith("\u2B1B")) {
        return ["#2d2d2d", emojis.replace("\u2B1B", "")]; // black
    }
}

function roundRect(ctx, x, y, width, height, radius) {
    radius = {tl: radius, tr: radius, br: radius, bl: radius};
    ctx.beginPath();
    ctx.moveTo(x + radius.tl, y);
    ctx.lineTo(x + width - radius.tr, y);
    ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
    ctx.lineTo(x + width, y + height - radius.br);
    ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
    ctx.lineTo(x + radius.bl, y + height);
    ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
    ctx.lineTo(x, y + radius.tl);
    ctx.quadraticCurveTo(x, y, x + radius.tl, y);
    ctx.closePath();
    ctx.fill();
}

function do_share(copy, shareType) {
    let color;
    let pair;
    let emojiStr;
    let i;
    printclear(acquire("answer12"), answer[0].toUpperCase() + " - " + answer[1].toUpperCase());
    printclear(acquire("answer34"), answer[2].toUpperCase() + " - " + answer[3].toUpperCase());

    let shouldShowWords = line >= TOTAL_LINES || (answer_correct[0] >= 0 && answer_correct[1] >= 0 && answer_correct[2] >= 0 && answer_correct[3] >= 0);
    let text_share;
    if (daily_mode) {
        text_share = "Topicle - " + key + "\n" +
            get_num_emoji(answer_correct[0]) +
            get_num_emoji(answer_correct[1]) + "\n" +
            get_num_emoji(answer_correct[2]) +
            get_num_emoji(answer_correct[3]);
    } else {
        text_share = "Beta Topicle\n" +
            get_num_emoji(answer_correct[0]) +
            get_num_emoji(answer_correct[1]) + (shouldShowWords ? " " + answer[0].toUpperCase() + " - " + answer[1].toUpperCase() : "") + "\n" +
            get_num_emoji(answer_correct[2]) +
            get_num_emoji(answer_correct[3]) + (shouldShowWords ? " " + answer[2].toUpperCase() + " - " + answer[3].toUpperCase() : "");
    }

    text_share += "\nhttps://kg583.github.io/topicle";
    let text_mobile_share = text_share;
    text_share += "\n\n";
    text_share += clue + "\n"


    let l1 = line - 1;
    if (answer_correct[0] >= 0 && answer_correct[1] >= 0 ) {
        l1 = Math.max(answer_correct[0], answer_correct[1])
    }
    let l2 = line - 1;
    if (answer_correct[2] >= 0 && answer_correct[3] >= 0) {
        l2 = Math.max(answer_correct[2], answer_correct[3])
    }
    for (i = 0; i <= l1; i++) {
        text_share += share[0][i] + " " + share[1][i] + "\n";
    }
    text_share += "\n"
    for (i = 0; i <= l2; i++) {
        text_share += share[2][i] + " " + share[3][i] + "\n";
    }

    if (copy && window.gtag) {
        gtag("event", "share", {
            mode: daily_mode ? "daily" : "beta",
            share_type: shareType,
            daily_key: daily_mode ? key : undefined
        });
    }

    printclear(acquire("share_content"), shareType === "image" ? text_mobile_share : text_share);

    if (copy) {
        acquire("share_content").select();
        document.execCommand("copy");
        acquire("share_content").blur();
        if (shareType === "clipboard") {
            alert("Copied results to clipboard!")
        }
    }

    printclear(acquire("share_content"), text_share);

    if (navigator.share) {
        if (shareType === "share") {
            navigator.share({
                text: text_share,
            });
        } else if (shareType === "image") {
            let size = 64;
            let padding = size / 16;
            let radius = size / 8;
            let fontScale = 0.75;
            let textPadding = size / 4;
            let canvas = document.querySelector("#canvas");
            canvas.width = (size + padding) * 11 - padding
            canvas.height = (size + padding) * (l1 + 1 + l2 + 1 + 4) - padding;
            let ctx = canvas.getContext("2d");
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // draw words 1 + 2
            let x = 0;
            let y = 0;
            for (i = 0; i <= l1; i++) {
                emojiStr = share[0][i];
                x = 0;
                while (emojiStr) {
                    pair = get_next_color_from_emojis(emojiStr);
                    color = pair[0];
                    emojiStr = pair[1]
                    ctx.fillStyle = color;
                    roundRect(ctx, x * (size + padding), y * (size + padding), size, size, radius);
                    x++;
                }

                emojiStr = share[1][i];
                x = 6;
                while (emojiStr) {
                    pair = get_next_color_from_emojis(emojiStr);
                    color = pair[0];
                    emojiStr = pair[1]
                    ctx.fillStyle = color;
                    roundRect(ctx, x * (size + padding), y * (size + padding), size, size, radius);
                    x++;
                }
                y++;
            }

            // draw middle text
            ctx.font = size * fontScale + 'px Arial';
            ctx.textAlign = "center";
            ctx.textBaseline = "alphabetic";
            ctx.fillStyle = "#ffffff";

            let titleText = daily_mode ? "Topicle - " + key : "Topicle";
            let metrics = ctx.measureText(titleText);
            let fontHeight = metrics.actualBoundingBoxAscent;
            ctx.fillText(titleText, canvas.width / 2, y * (size + padding) + size - (size - fontHeight) / 2, canvas.width - textPadding * 2);
            y++;
            for (let row = 0; row < 2; row++) {
                for (i = 0; i < 2; i++) {
                    ctx.fillStyle = answer_correct[i + row * 2] >= 0 ? "#00a6ed" : "#f8312f";
                    let dir = (i * 2 - 1);
                    let xTopCenter = canvas.width / 2 + dir * (padding / 2) + dir * (size / 2);
                    roundRect(ctx, xTopCenter - size / 2, y * (size + padding), size, size, radius);
                    if (answer_correct[i + row * 2] >= 0) {
                        ctx.textAlign = "center";
                        ctx.fillStyle = "#ffffff";
                        var numText = answer_correct[i + row * 2] + 1
                        metrics = ctx.measureText(numText);
                        fontHeight = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;
                        ctx.fillText(
                            numText,
                            xTopCenter,
                            y * (size + padding) + size - (size - fontHeight) / 2,
                            size
                        );
                    }
                }
                if (beta_mode && shouldShowWords) {
                    ctx.textAlign = "right";
                    ctx.fillStyle = "#ffffff";
                    let wordText = answer[row * 2].toUpperCase();
                    metrics = ctx.measureText(wordText);
                    fontHeight = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;
                    ctx.fillText(
                        wordText,
                        canvas.width / 2 - padding / 2 - size - textPadding,
                        y * (size + padding) + size - (size - fontHeight) / 2,
                        canvas.width / 2 - padding - size - textPadding * 2
                    )
                    ctx.textAlign = "left";
                    wordText = answer[1 + row * 2].toUpperCase()
                    metrics = ctx.measureText(wordText);
                    fontHeight = metrics.actualBoundingBoxAscent + metrics.actualBoundingBoxDescent;
                    ctx.fillText(
                        wordText,
                        canvas.width / 2 + padding / 2 + size + textPadding,
                        y * (size + padding) + size - (size - fontHeight) / 2,
                        canvas.width / 2 - padding - size - textPadding * 2
                    )
                }
                y++;
            }
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillStyle = "#ffffff";
            ctx.fillText(clue, canvas.width / 2, y * (size + padding) + (size / 2), canvas.width);
            y++;

            // draw words 3 + 4
            for (i = 0; i <= l2; i++) {
                emojiStr = share[2][i];
                x = 0;
                while (emojiStr) {
                    pair = get_next_color_from_emojis(emojiStr);
                    color = pair[0];
                    emojiStr = pair[1]
                    ctx.fillStyle = color;
                    roundRect(ctx, x * (size + padding), y * (size + padding), size, size, radius);
                    x++;
                }

                emojiStr = share[3][i];
                x = 6;
                while (emojiStr) {
                    pair = get_next_color_from_emojis(emojiStr);
                    color = pair[0];
                    emojiStr = pair[1]
                    ctx.fillStyle = color;
                    roundRect(ctx, x * (size + padding), y * (size + padding), size, size, radius);
                    x++;
                }
                y++;
            }

            canvas.toBlob(function(blob) {
                let file = new File([blob], "topicle.png", {type: "image/png"});
                navigator.share({
                    files: [file],
                    text: text_mobile_share
                });
            });
        }
    }
}

function render_bg_keys() {
    const keys = "abcdefghijklmnopqrstuvwxyz".split("");

    let pos = " 50%";
    if (answer_correct[0] < 0 && answer_correct[1] >= 0) pos = " 90%";
    if (answer_correct[1] < 0 && answer_correct[0] >= 0) pos = " 10%";

    for (k in keys) {
        let g;
        let keyGuessed = false;
        const keyColors = ["rgb(24, 26, 27)", "rgb(24, 26, 27)", "rgb(24, 26, 27)", "rgb(24, 26, 27)"];
        const colorOptions = ["#919191", "#ffcc00", "#00cc88"];
        let gradStrArr = [];
        for (g = 0; g < keyColors.length; g++) {
            for (let i = 0; i < colorOptions.length; i++) {
                if (guess_letters[g][keys[k]] === i) {
                    keyColors[g] = colorOptions[i]
                    keyGuessed = true
                }
            }
        }

        for (g = 0; g < keyColors.length; g++) {
            if (keyGuessed && keyColors[g] === "rgb(24, 26, 27)") {
                keyColors[g] = "#5c5c5c"
            }
            gradStrArr.push("linear-gradient(45deg, " + keyColors[g] + ", " + keyColors[g] + ")");
        }
        let bg = gradStrArr.join(",");
        let key = acquire(keys[k]);
        key.style.backgroundImage = bg
        key.style.backgroundSize = "50% 50%";
        key.style.backgroundPosition = "0% 0%, 100% 0%, 0% 100%, 100% 100%"
        key.style.backgroundRepeat = "no-repeat"
        key.style.color = keyGuessed ? "black" : "white"
        // key.style.textShadow = keyGuessed ? "0 0 4px white" : ""
    }
}

document.addEventListener('keydown', pressKey);

window.onresize = function() {
    let body = acquire("body");

    let mode = localStorage.getItem("widescreen");
    let wideScreenAllowed = window.innerWidth > 1570;

    let showWidescreenQuestion = !mode && wideScreenAllowed;
    let showWidescreen = mode === "yes" && wideScreenAllowed;
    let showNormalScreen = !showWidescreen;
    let showReset = !!mode && wideScreenAllowed;

    if(!(showWidescreen && (daily_mode || beta_mode))) {
        body.style.maxWidth = "550px";
        body.style.fontSize = body.clientWidth / 15 + "px";
        acquire('game').style.margin = "";
        acquire("share_content").style.fontSize = (body.clientWidth / 550 * 30) + "%";
        document.documentElement.style.setProperty('--boxsize', (body.clientWidth / 11) + 'px');
        document.documentElement.style.setProperty('--spacing', body.clientWidth <= 300 ? '0px' : '2px');
        document.documentElement.style.setProperty('--collapse', body.clientWidth <= 300 ? 'collapse' : 'collapse');
    } else {
        let fontSize = Math.min(28, body.clientWidth / 15);
        body.style.maxWidth = "98vw";
        body.style.fontSize = fontSize + "px";
        acquire('game').style.margin = "0 auto";
        acquire("share_content").style.fontSize = (body.clientWidth / 550 * 30) + "%";
        document.documentElement.style.setProperty('--boxsize', (fontSize * 1.75) + 'px');
        document.documentElement.style.setProperty('--spacing', body.clientWidth <= 300 ? '0px' : '2px');
        document.documentElement.style.setProperty('--collapse', body.clientWidth <= 300 ? 'collapse' : 'collapse');
    }

    acquire('widescreen-question').style.display = showWidescreenQuestion ? "block" : "none";
    acquire('normal-container').style.display = showNormalScreen ? "block" : "none";
    acquire('widescreen-container').style.display = showWidescreen ? "block" : "none";
    acquire('widescreen-reset').style.display = showReset ? "block" : "none";
}
window.onresize();

setupBoxes();
onStateChange();

</script>
</body>
</html>
